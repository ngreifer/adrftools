---
output:
  github_document:
always_allow_html: yes
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  fig.width = 5.5,
  fig.height = 3.5,
  fig.align = "center",
  message = FALSE,
  fig.path = "man/figures/README-"
)
```

# *adrftools*

<!-- badges: start -->
<!-- badges: end -->
------

### Overview
*adrftools* is an R package for estimating the average dose-response function (ADRF), which characterizes the effect of a continuous treatment on an outcome. Functionality is included for performing g-computation on a regression model to estimate the ADRF, plot the ADRF, and test hypotheses about the ADRF. See `vignette("adrftools")` for a full tutorial on using *adrftools*.

### Installation

You can install the current stable version of *adrftools* from CRAN with:

``` r
install.packages("adrftools")
```

You can install the development version of *adrftools* from [GitHub](https://github.com/ngreifer/adrftools) with:

``` r
# install.packages("pak")
pak::pak("ngreifer/adrftools")
```

### Example

Below we use *adrftools* to estimate and characterize the effect of blood lead levels on scores on a cognitive test, adjusting for potential confounders using g-computation.

```{r example}
library(adrftools)

data("nhanes3lead")
```

Here, the treatment is `logBLL`, the outcome is `Math`, and the confounders to be adjusted for are `Age`, `Male`, `Race`, `PIR`, `Enough_Food`, `Smoke_in_Home`, `Smoke_Pregnant`, and `NICU`. We'll first fit an outcome model that adjusts for these confounders.

```{r}
fit <- lm(Math ~ splines::ns(logBLL, df = 5) * 
            (Age + Race + Male + PIR + Enough_Food +
               Smoke_in_Home + Smoke_Pregnant + NICU),
          data = nhanes3lead)
```

Next we'll use `adrftools::adrf()` to compute the ADRF.

```{r}
adrf_bll <- adrf(fit, treat = "logBLL")

adrf_bll
```

We can plot the ADRF using `plot()`:

```{r}
plot(adrf_bll)
```

By default, this produces simultaneous 95% confidence bands.

`adrf_bll` is an `effect_curve` object, which is a function. We can supply to it values of the treatment to compute the corresponding value of the ADRF at those treatment values:

```{r}
adrf_bll(logBLL = c(0, .5, 1, 1.5, 2))
```

We can also produce confidence intervals using `summary()` on the above output:

```{r}
adrf_bll(logBLL = c(0, .5, 1, 1.5, 2)) |>
  summary()
```

To test an omnibus hypothesis about the ADRF, such as whether it is flat or linear, we can use `summary()` on the `effect_curve` object itself:

```{r}
# Test for flatness
summary(adrf_bll, hypothesis = "flat")

# Test for linearity
summary(adrf_bll, hypothesis = "linear")
```

The results indicate that the ADRF is not flat, but there isn't enough evidence to claim it is nonlinear in the range specified. We might project a linear model onto the ADRF to produce a more interpretable summary:

```{r}
proj <- curve_projection(adrf_bll, model = "linear")
```

Below, we plot the linear projection along with the original ADRF:

```{r}
plot(adrf_bll, proj = proj)
```

To examine the coefficient describing the projection, we can use `summary()` on the projection:

```{r}
summary(proj)
```

Based on the above, we might conclude the following:

> There is some relationship between `logBLL` and `Math` adjusting for the included potential confounders, based on rejection of the hypothesis that the ADRF is flat for `logBLL` values between -0.3567 and 2.4248 (p < .0001). There isn't evidence that the ADRF is nonlinear within this range (p = .3153). The linear projection has a coefficient of -.643 (p < .0001), indicating that the expected potential outcome of `Math` decreases by this amount for each unit increase in `logBLL`.

See `vignette("adrftools")` for more information on how to use *adrftools* and the other features available.
