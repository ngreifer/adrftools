<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>adrftools • adrftools</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="adrftools">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">adrftools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/adrftools.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/adrftools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>adrftools</h1>
                        <h4 data-toc-skip class="author">Noah
Greifer</h4>
            
            <h4 data-toc-skip class="date">2025-12-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/adrftools/blob/main/vignettes/adrftools.Rmd" class="external-link"><code>vignettes/adrftools.Rmd</code></a></small>
      <div class="d-none name"><code>adrftools.Rmd</code></div>
    </div>

    
    
<style>
/* Make output scroll */
pre {overflow-x: auto;}
pre code {word-wrap: normal; white-space: pre;}

/* Hide empty headers created to terminate tabsets */
h1:empty, h2:empty, h3:empty, h4:empty, h5:empty, h6:empty {
  display: none; margin: 0; padding: 0; border: none;
}
</style>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><em>adrftools</em> contains functions to support effect estimation,
inference, and visualization with continuous (i.e., non-discrete)
treatments. The primary estimand with a continuous treatment is the
average dose-response function (ADRF), <span class="math display">\[
\theta_\text{ADRF}(a) = E[Y(a)]
\]</span>where <span class="math inline">\(Y(a)\)</span> is the
potential outcome under treatment value <span class="math inline">\(a\)</span> and <span class="math inline">\(E[.]\)</span> is the expectation operator, here
taken over the distribution of covariates <span class="math inline">\(X\)</span> in the population, where <span class="math inline">\(Y(a) = h_a(X)\)</span> for some function <span class="math inline">\(h_a()\)</span>. Unlike with categorical treatments
for which the treatment effect can be understood as a contrast between
expected potential outcomes under the fixed treatment levels, the effect
of a continuous treatment is a function, which makes interpreting it and
communicating it challenging. <em>adrftools</em> aims to simplify these
tasks while allowing for a rich understanding of the relationship being
studied.</p>
<p>When certain causal assumptions are met by the data and study design,
the ADRF can be identified as <span class="math display">\[
E[Y(a)]=E_X\left[E[Y|A=a,X]\right]
\]</span>Much of the effort in the causal inference literature has been
on finding consistent estimators of this function. This is often quite
challenging because in addition to requiring knowledge of the
relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(A\)</span> or between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> (or both), it requires knowledge about
the relationship between <span class="math inline">\(A\)</span> and
<span class="math inline">\(Y\)</span>. With categorical treatments,
this latter relationship is direct. Popular methods for adjusting for
<span class="math inline">\(X\)</span> in estimating the ADRF include
weighting, g-computation, and doubly-robust approaches. See <span class="citation">Zhang et al. (<a href="#ref-zhangCausalInferenceQuantitative2016">2016</a>)</span> for a
review of these methods.</p>
<p>A full characterization of the ADRF can involve multiple steps.
Often, the ADRF does not correspond directly to a set of coefficients in
the outcome model. Rather, it must be computed for each treatment value
from the outcome model parameters using g-computation. This means simply
writing down the ADRF as a function of parameters is either impossible
or would fail to provide interpretable information about the effect of
treatment. There are a few solutions to this problem: one is to
visualize the ADRF in a plot. Another is to project a simpler function
onto the ADRF as a more interpretable summary; this strategy is
described in <span class="citation">Neugebauer and Laan (<a href="#ref-neugebauerNonparametricCausalEffects2007">2007</a>)</span>.
<em>adrftools</em> provides functionality for both of these
strategies.</p>
<p>One may also want to perform inference on the ADRF to answer
substantive questions, such as whether the ADRF is flat, whether the
ADRF is linear, or whether the slope of a linear projection of the ADRF
is nonzero. Inference for the ADRF can be challenging, as multiple
sources of uncertainty must be accounted for, including sampling from
the population, estimation of weights to balance covariates, and
estimation of the outcome model parameters. <em>adrftools</em> offers
methods to account for this uncertainty when performing inference on the
ADRF.</p>
<div class="section level3">
<h3 id="effect-curves">Effect Curves<a class="anchor" aria-label="anchor" href="#effect-curves"></a>
</h3>
<p>The ADRF is one of a variety of functions we call “effect curves”,
which are functions of the treatment. The following are the other effect
curves available in <em>adrftools</em>:</p>
<ul>
<li>A subgroup ADRF (where <span class="math inline">\(G\)</span> is a
grouping variable and <span class="math inline">\(g\)</span> is a level
of <span class="math inline">\(G\)</span>): <span class="math display">\[\theta_{\text{ADRF},g}(a) =
E\left[Y(a)|G=g\right]\]</span>
</li>
<li>The average marginal effect function (AMEF), defined as the
derivative of the ADRF: <span class="math display">\[\theta_\text{AMEF}(a) =
\frac{d\theta_\text{ADRF}(a_0)}{da_0}\Bigr|_{a_0 = a}\]</span>
</li>
<li>The reference effect curve, defined as the contrast between each
point on an effect curve (<span class="math inline">\(\theta(a)\)</span>) and a given (fixed) value on
that curve (<span class="math inline">\(\theta(a')\)</span>): <span class="math display">\[\theta_\text{ref}(a; a') = \theta(a) -
\theta(a')\]</span>
</li>
<li>The effect curve contrast, defined as the contrast between effect
curves computed within subgroups <span class="math inline">\(G=g_1\)</span> and <span class="math inline">\(G=g_2\)</span>: <span class="math display">\[\theta_\text{contr}(a; g_1, g_2) =
\theta_{g_1}(a) - \theta_{g_2}(a)\]</span>
</li>
</ul>
<p>All of these are linear functions of the ADRF, which means if we can
account for uncertainty in the ADRF, we can account for uncertainty in
the effect curves derived from it.</p>
</div>
<div class="section level3">
<h3 id="this-guide">This Guide<a class="anchor" aria-label="anchor" href="#this-guide"></a>
</h3>
<p>In this guide, we will walk through a standard analysis,
demonstrating how we can use <em>adrftools</em> to perform the tasks
above. First we’ll load <em>adrftools</em> using
<code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ngreifer/adrftools" class="external-link">adrftools</a></span><span class="op">)</span></span></code></pre></div>
<p>In what follows, we’ll describe the dataset used in this tutorial and
the help files of the package functions. Next, we’ll describe the basics
of the package as it is used to construct, visualize, and perform
inference on the ADRF. Next we’ll discuss other effect curves, and
finally other scenarios that require special attention (non-continuous
outcome, multiply imputed data, and sampling and balancing weights).</p>
</div>
</div>
<div class="section level2">
<h2 id="the-data">The Data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h2>
<p>The data we use in this guide is the <code>nhanes3lead</code> dataset
that comes with <em>adrftools</em>. This data is a subset of the NHANES
III survey. We will estimate and characterize the effect of blood lead
levels on cognitive test scores, adjusting for potential
confounders.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nhanes3lead"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nhanes3lead</span><span class="op">)</span></span>
<span><span class="co">#&gt;         Age Male     Race   PIR Enough_Food Smoke_in_Home Smoke_Pregnant NICU</span></span>
<span><span class="co">#&gt; 1 10.583333    0    White 1.266           1             0              0    0</span></span>
<span><span class="co">#&gt; 2  7.166667    0    Black 0.603           1             1              1    0</span></span>
<span><span class="co">#&gt; 3 11.916667    0 Hispanic 3.173           1             0              0    0</span></span>
<span><span class="co">#&gt; 4  6.583333    1    White 1.543           1             1              0    0</span></span>
<span><span class="co">#&gt; 5  8.250000    0    White 3.043           1             0              0    0</span></span>
<span><span class="co">#&gt; 6  8.250000    1    Other 1.746           1             1              0    0</span></span>
<span><span class="co">#&gt;       logBLL Math Reading Block Digit   MEC_wt</span></span>
<span><span class="co">#&gt; 1 -0.3566749   10       8    12     7  7785.67</span></span>
<span><span class="co">#&gt; 2  2.0014800   13       9     8    12 11001.98</span></span>
<span><span class="co">#&gt; 3  1.3609766    6      10    11     7  7024.62</span></span>
<span><span class="co">#&gt; 4  1.1631508    6       5     8     5  7901.41</span></span>
<span><span class="co">#&gt; 5  0.7419373    8       9    14     8  9997.87</span></span>
<span><span class="co">#&gt; 6  1.3609766   12      10    11     8 11979.76</span></span></code></pre></div>
<p>The treatment variables is <code>logBLL</code>, the natural log of
blood lead levels in μg/dL, and for this analysis, we will use
<code>Math</code> as the outcome variable, which is the score on the
WISC Math test. Covariates include <code>Age</code>, <code>Male</code>,
<code>Race</code>, <code>PIR</code>, <code>Enough_Food</code>,
<code>Smoke_in_Home</code>, <code>Smoke_Pregnant</code>, and
<code>NICU</code>.</p>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>We will use g-computation to estimate the ADRF of <code>logBLL</code>
on <code>Math</code> adjusting for the covariates. It is also possible
to use weighted g-computation or propensity score weighting alone to
adjust for the covariates; we will demonstrate those in the section
“Additional Scenarios”. The procedure for these is essentially the
same.</p>
<p>We will use <em>adrftools</em> to answer the following research
questions:</p>
<ul>
<li>What does the ADRF look like?</li>
<li>Is the ADRF flat?</li>
<li>Is the ADRF linear?</li>
<li>What is the linear projection of the ADRF? Is its slope zero?</li>
<li>What is the expected difference in Math scores under a low and high
level of blood lead exposure?</li>
</ul>
<div class="section level3">
<h3 id="fitting-the-outcome-model">Fitting the outcome model<a class="anchor" aria-label="anchor" href="#fitting-the-outcome-model"></a>
</h3>
<p>The first step is to fit the outcome model. This model is not to be
interpreted and should flexible enough to capture nonlinear
relationships, especially between the treatment and the outcome.
<em>adrftools</em> supports any model also supported by
<em>marginaleffects</em>, but performance is improved with models fit
with <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> or <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>.</p>
<p>Below, we use <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> to fit a linear regression of
<code>Math</code> on <code>logBLL</code>, the covariates, and their
interaction. We will supply <code>logBLL</code> as a natural cubic
spline with 5 degrees of freedom to capture potential nonlinearities
using <code><a href="https://rdrr.io/r/splines/ns.html" class="external-link">splines::ns()</a></code>. We will also allow the full ADRF to
vary across levels of <code>Male</code> to allow us to examine sex
differences later.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Math</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">logBLL</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="va">Male</span> <span class="op">*</span></span>
<span>            <span class="op">(</span><span class="va">Age</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span> <span class="va">Smoke_in_Home</span> <span class="op">+</span></span>
<span>               <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span><span class="op">)</span>,</span>
<span>          data <span class="op">=</span> <span class="va">nhanes3lead</span><span class="op">)</span></span></code></pre></div>
<p>We won’t even look at this model; none of its coefficients are
interpretable. Instead, we’ll use functions in <em>adrftools</em> to
characterize the ADRF and perform inference on it.</p>
</div>
<div class="section level3">
<h3 id="computing-and-plotting-the-adrf">Computing and plotting the ADRF<a class="anchor" aria-label="anchor" href="#computing-and-plotting-the-adrf"></a>
</h3>
<p>To compute the ADRF, we supply the outcome model to
<code><a href="../reference/adrf.html">adrf()</a></code>, which also requires the name of the treatment to be
supplied to <code>treat</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_bll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">fit</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span><span class="op">)</span></span></code></pre></div>
<p>The ADRF is only evaluated for a range of treatment values. That
range can be controlled by the <code>range</code> argument to
<code><a href="../reference/adrf.html">adrf()</a></code>. By default, the range is the middle 95% of
treatment values, which in the case corresponds to values from -0.3567
to 2.4248. It is important to know this range because all inferences
made generalize only to treatment values in this range. Typically,
values on the edges of the observed treatment range are estimated with
less certainty, and values beyond the observed treatment range involve
extrapolation.</p>
<p><code><a href="../reference/adrf.html">adrf()</a></code> also provides options for uncertainty estimation
using the <code>vcov</code> argument. The default,
<code>vcov = "unconditional"</code>, uses M-estimation to account for
uncertainty in estimation and sampling analytically as described by
<span class="citation">Hansen and Overgaard (<a href="#ref-hansenVarianceEstimationAverage2024">2024</a>)</span>; this
requires the model object to have <code>estfun()</code> and
<code>bread()</code> methods. Setting <code>vcov = "boot"</code> or
<code>vcov = "fwb"</code> use the traditional or fractional weighted
bootstrap <span class="citation">(<a href="#ref-xu2020">Xu et al.
2020</a>)</span>, respectively, as implemented in <em>fwb</em>; these
both also account for sampling and estimation uncertainty. Finally, any
argument to the <code>vcov</code> argument of
<code>marginaleffects::vcov()</code> can be supplied to perform
conditional inference (i.e., treating the sample as fixed); the
“default” variance can be requested by setting
<code>vcov = "conditional"</code> (which typically just uses the
<code><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov()</a></code> method for the model object).</p>
<p>The output of <code><a href="../reference/adrf.html">adrf()</a></code> is an <code>effect_curve</code>
object. Printing the object displays some information about the effect
curve.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_bll</span></span>
<span><span class="co">#&gt; An <span style="font-style: italic;">effect_curve</span> object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  - curve type: ADRF</span></span>
<span><span class="co">#&gt;  - response: Math</span></span>
<span><span class="co">#&gt;  - treatment: logBLL</span></span>
<span><span class="co">#&gt;    + range: -0.3567 to 2.4248</span></span>
<span><span class="co">#&gt;  - inference: unconditional</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Use `plot()` (`?adrftools::plot.effect_curve()`) to plot</span> <span style="font-style: italic;">the curve, `summary()`</span> <span style="font-style: italic;">(`?adrftools::summary.effect_curve()`) to test the curve,</span> <span style="font-style: italic;">or `{object}(values)` (`?adrftools::effect_curve-class()`)</span> <span style="font-style: italic;">to compute estimates.</span></span></span></code></pre></div>
<p>An <code>effect_curve</code> object is a function that takes in
values of the treatment and returns estimates of the ADRF at those
points. For example, to display the ADRF estimates at values of
<code>logBLL</code> equal to 0, 1, and 2, we can run the following:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">adrf_bll</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  ADRF Estimates</span></span>
<span><span class="co">#&gt; ────────────────</span></span>
<span><span class="co">#&gt;  logBLL Estimate</span></span>
<span><span class="co">#&gt;       0    8.421</span></span>
<span><span class="co">#&gt;       1    8.025</span></span>
<span><span class="co">#&gt;       2    7.146</span></span>
<span><span class="co">#&gt; ────────────────</span></span></code></pre></div>
<p>Perhaps the most useful summary of an effect curve is its plot, which
we can produce simply by running <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on the
<code>effect_curve</code> object:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>The x-axis is the treatment and the y-axis is the value of the ADRF
at the treatment level (labeled <span class="math inline">\(\text{E[Math]}\)</span>). The solid red line is
the ADRF and the pink ribbon is the 95% uniform confidence band.</p>
<p>By default, confidence bands are computed providing uniform coverage,
meaning the nominal rate refers to simultaneous coverage of all points
on the line rather for a single given point <span class="citation">(<a href="#ref-montielolea2019">Montiel Olea and Plagborg-Møller
2019</a>)</span>. Pointwise confidence bands can instead be requested by
setting <code>simultaneous = FALSE</code> in the call to
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. This is generally not recommended as it overstates
the precision of the estimated ADRF. The confidence level can be set
with <code>conf_level</code>, and if bootstrapping is used in
<code><a href="../reference/adrf.html">adrf()</a></code>, the method of computing the confidence interval can
be controlled by the <code>ci.type</code> argument, which is passed to
<code><a href="https://ngreifer.github.io/fwb/reference/summary.fwb.html" class="external-link">fwb::summary.fwb()</a></code>. Simultaneous coverage is only possible
when <code>ci.type</code> is <code>"perc"</code> (percentile confidence
intervals, the default for bootstrapping) or <code>"wald"</code>.</p>
<p>To compute confidence intervals around specific points of the ADRF,
one can use <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on the output of the
<code>effect_curve</code> object:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">adrf_bll</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;               ADRF Estimates</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  logBLL Estimate Std. Error CI Low CI High</span></span>
<span><span class="co">#&gt;       0    8.421     0.1678  8.021   8.822</span></span>
<span><span class="co">#&gt;       1    8.025     0.1124  7.757   8.293</span></span>
<span><span class="co">#&gt;       2    7.146     0.2162  6.630   7.661</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (t* = 2.386, df = 2401)</span></span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> accepts the same arguments as
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to control the confidence interval coverage and
whether inference is simultaneous. Unlike with <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, with
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, simultaneous inference only accounts for the
estimates requested, not the full effect curve.</p>
<p>Points along the ADRF can be contrasted pairwise using
<code><a href="../reference/point_contrast.html">point_contrast()</a></code> on the output of the
<code>effect_curve</code> object (and then using <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>
on that output):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">adrf_bll</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/point_contrast.html">point_contrast</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                           ADRF Point Contrasts</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;                         Term Estimate Std. Error      t  P-value  CI Low</span></span>
<span><span class="co">#&gt;  [logBLL = 1] - [logBLL = 0]  -0.3964     0.2127 -1.863   0.1476 -0.8938</span></span>
<span><span class="co">#&gt;  [logBLL = 2] - [logBLL = 0]  -1.2757     0.2800 -4.556 &lt; 0.0001 -1.9305</span></span>
<span><span class="co">#&gt;  [logBLL = 2] - [logBLL = 1]  -0.8793     0.2642 -3.328   0.0025 -1.4972</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (t* = 2.338, df = 2401)</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Null value: 0</span></span></span></code></pre></div>
<p>In addition to the contrast estimates and confidence intervals, test
statistics and p-values for the tests that the contrasts are equal to 0
are displayed. The <code>Null value</code> note below the table
indicates the null value used for the tests.</p>
</div>
<div class="section level3">
<h3 id="testing-the-adrf">Testing the ADRF<a class="anchor" aria-label="anchor" href="#testing-the-adrf"></a>
</h3>
<p>To test omnibus hypotheses about the ADRF, such as whether it is flat
or linear, we can use <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on the
<code>effect_curve</code> object itself, rather than on its output. In
particular, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> tests whether a given projection of
the ADRF is sufficient to characterize it. This projection is determined
by the argument to <code>hypothesis</code>. By default, this is
<code>"flat"</code>, which tests that null hypothesis that the ADRF is
flat. If this hypothesis is rejected, this implies there is some effect
of the treatment.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF is flat for values of logBLL between -0.3567</span></span>
<span><span class="co">#&gt;     and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   P-value</span></span>
<span><span class="co">#&gt;  &lt; 0.0001</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span></code></pre></div>
<p>This test works in two steps: first, the projection <span class="math inline">\(\hat{P}(a)\)</span> is computed, and second, the
residuals of the projection are used to compute the test statistic. The
test statistic <span class="math inline">\(T\)</span> is defined as</p>
<p><span class="math display">\[
T=\int_{a_\text{low}}^{a_\text{high}} {\left(\hat{\theta}(a) -
\hat{P}(a) \right)^2 da}
\]</span></p>
<p>where <span class="math inline">\(\hat{\theta}(a)\)</span> is the
ADRF estimate at treatment value <span class="math inline">\(a\)</span>
and <span class="math inline">\(a_\text{low}\)</span> and <span class="math inline">\(a_\text{high}\)</span> are the lower and upper
bounds of the treatment domain, respectively. If the ADRF is perfectly
flat, <span class="math inline">\(T=0\)</span> because the difference
between the ADRF and its flat projection will be 0. It is possible to
compute the cumulative distribution function (CDF) of <span class="math inline">\(T\)</span> under the null hypothesis that the true
ADRF is equal to the specified projection, and that CDF is used to
compute the p-value along with the test statistic <span class="math inline">\(T\)</span> computed in the sample.</p>
<p>There are several methods of approximating the CDF, and this choice
is controlled by the <code>method</code> argument to
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>:</p>
<ol style="list-style-type: decimal">
<li>Monte Carlo simulation of the distribution of <span class="math inline">\(T\)</span> under the null hypothesis
(<code>method = "sim"</code>)</li>
<li>Analytic approximation using functionality in the
<em>CompQuadForm</em> package (<code>method = "imhof"</code>,
<code>"davies"</code>, or <code>"liu"</code>)</li>
<li>Satterthwaite’s approximation based on moment matching to a <span class="math inline">\(\chi^2\)</span> distribution
(<code>method = "satterthwaite"</code>)</li>
<li>Kuonen’s saddlepoint approximation using functionality in the
<em>survey</em> package (<code>method = "saddlepoint"</code>)</li>
</ol>
<p><code>method = "imhof"</code> and <code>method = "sim"</code> are the
most reliable. The former is fast and deterministic, and so is used by
default when the <em>CompQuadForm</em> package is installed. The latter
is slower and subject to Monte Carlo error, but does not require any
additional packages. <code>method = "saddlepoint"</code> performs well,
too, and is used by default if the <em>CompQuadForm</em> package is not
installed but the <em>survey</em> package is.</p>
<p><code>hypothesis</code> can also be <code>"linear"</code>,
<code>"quadratic"</code>, <code>"cubic"</code>, or a formula
representing the projection to test. Rejecting the null hypothesis
indicates that the ADRF is more complicated than the supplied model; for
example, rejecting the null hypothesis for
<code>hypothesis = "linear"</code> means the ADRF is nonlinear, and
failing to reject the null hypothesis for for
<code>hypothesis = "quadratic"</code> means there is not enough evidence
to claim the ADRF is more complicated than a quadratic model. Rejecting
any of these hypotheses also rejects the null hypothesis for a
lower-order model, including <code>"flat"</code>.</p>
<p>Finally, <code>hypothesis</code> can be a single number, indicating
the null hypothesis that the ADRF is flat and equal to that value.
Typically, this is more useful when testing other effect curves that
have a natural null value (e.g., 0).</p>
<p>In the example above, the p-value for the test that the ADRF is flat
in the range listed is less than .0001, so we can reject the null
hypothesis that the line is flat and therefore claim that there is an
effect of <code>logBLL</code> on <code>Math</code>. We can also test
whether the ADRF is approximately linear:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll</span>, hypothesis <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF is linear for values of logBLL between</span></span>
<span><span class="co">#&gt;     -0.3567 and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  P-value</span></span>
<span><span class="co">#&gt;    0.478</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span></code></pre></div>
<p>In this case, the high p-value indicates that we cannot reject the
null hypothesis that the ADRF is linear, even though there appears to be
a curve in the plot. We can interpret this as indicating that a linear
ADRF is consistent with the data, or, more precisely, that there isn’t
evidence that the ADRF is nonlinear.</p>
<p>It’s important to only interpret these tests within the range listed
in the test output. It is possible for the ADRF to have a different
shape beyond this range, and it is possible that including a different
range could change the results of the test. For example, including parts
of the ADRF that are estimated with less precision can make the whole
test less precise.</p>
</div>
<div class="section level3">
<h3 id="estimating-a-linear-projection">Estimating a linear projection<a class="anchor" aria-label="anchor" href="#estimating-a-linear-projection"></a>
</h3>
<p>Though we have characterized, visualized, and tested the ADRF in a
flexible way, there may be use in finding a simpler representation of it
that can be used as a more interpretable summary. We were unable to
reject the null hypothesis that the ADRF is linear, so we can try
projecting the ADRF onto a linear model to more easily interpret its
form as a slope and intercept. This will also allow us to make a firmer
statement about the magnitude and direction of the effect of
<code>logBLL</code> on <code>Math</code>. We don’t need to re-fit the
outcome model; the outcome model does not correspond to the ADRF because
it is a conditional model, whereas the ADRF marginalizes over the
distribution of covariates. Instead, we can use
<code><a href="../reference/curve_projection.html">curve_projection()</a></code> to perform the projection.</p>
<p><code><a href="../reference/curve_projection.html">curve_projection()</a></code> takes in an <code>effect_curve</code>
object and a projection model that includes only the treatment. This
model can be in any form, but in this case, it makes sense to supply a
simple linear model. Any value that can be supplied to
<code>hypothesis</code> in <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> can be supplied to the
<code>model</code> argument of <code><a href="../reference/curve_projection.html">curve_projection()</a></code>, which
essentially fits a linear regression of the effect curve estimates on
the treatment values and correctly accounts for the uncertainty in the
effect curve estimates for estimating the uncertainty of the projection
model parameters. The projection is formed by minimizing the loss
function</p>
<p><span class="math display">\[
\int_{a_\text{low}}^{a_\text{high}}{\left(\hat{\theta}(a)-\hat{P}(a)\right)^2
\,da}
\]</span></p>
<p>where <span class="math inline">\(\hat{P}(a)\)</span> is the
projection model evaluated at treatment value <span class="math inline">\(a\)</span>. When requesting a linear
projection,</p>
<p><span class="math display">\[
\hat{P}(a)=\hat b_0 + \hat b_1 a
\]</span></p>
<p>Below, we fit the linear projection using
<code><a href="../reference/curve_projection.html">curve_projection()</a></code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/curve_projection.html">curve_projection</a></span><span class="op">(</span><span class="va">adrf_bll</span>, <span class="st">"linear"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">proj</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  ADRF Projection Coefficients</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;         Term Estimate Std. Error     t  P-value CI Low CI High</span></span>
<span><span class="co">#&gt;  (Intercept)    8.486     0.1322 64.18 &lt; 0.0001  8.226   8.745</span></span>
<span><span class="co">#&gt;       logBLL   -0.613     0.1267 -4.84 &lt; 0.0001 -0.861  -0.364</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (t* = 1.961, df = 2401)</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Null value: 0</span></span></span></code></pre></div>
<p>The output of <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> is similar to that when applied
to an <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> object; we can see the coefficient estimates,
standard errors, tests, and confidence intervals. As expected, we find a
negative slope that is significant at the .001 level, indicating that a
one-unit increase in <code>logBLL</code> corresponds to a decrease in
average <code>Math</code> scores.</p>
<p>We can plot the projection either alone or on top of the ADRF plot.
To plot it alone, we can simply use <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on the
<code><a href="../reference/curve_projection.html">curve_projection()</a></code> output:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">proj</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-14-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>This plot is similar in interpretation to the ADRF plot.</p>
<p>To add the projection to the original estimated ADRF plot, we can
supply the <code><a href="../reference/curve_projection.html">curve_projection()</a></code> output to the
<code>proj</code> argument of <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> applied to the
original <code>effect_curve</code> object:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll</span>, proj <span class="op">=</span> <span class="va">proj</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-15-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>The dotted line is the projection, and the solid line and shaded
region correspond to the original ADRF estimate and the original ADRF
estimate’s confidence bands.</p>
<p>Two nested projection models can be compared with a Wald test using
<code><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova()</a></code>, just as for typical linear models.</p>
</div>
<div class="section level3">
<h3 id="other-effect-curves">Other effect curves<a class="anchor" aria-label="anchor" href="#other-effect-curves"></a>
</h3>
<p>There is more to learn about the effect of the treatment on the
outcome than the ADRF alone can provide. Other effect curves help us
answer substantive questions about this effect. Below, we’ll describe
computing reference effect curves, the average marginal effect function
(AMEF), subgroup ADRFs, and contrasts between subgroup ADRFs. All these
steps use the ADRF as a building block.</p>
<div class="section level4">
<h4 id="reference-effect-curves">Reference effect curves<a class="anchor" aria-label="anchor" href="#reference-effect-curves"></a>
</h4>
<p>A reference effect curve is a function representing the contrast
between the ADRF and the ADRF at a single level of the treatment. For
example, one may be interested in characterizing the effect of treatment
as the difference between the ADRF at nonzero treatment values and the
ADRF with treatment set to 0, as in <span class="citation">Hill (<a href="#ref-hillBayesianNonparametricModeling2011">2011</a>)</span>.</p>
<p>To compute a reference effect curve for the ADRF, we can supply the
ADRF to <code><a href="../reference/reference_curve.html">reference_curve()</a></code>, supplying an argument to
<code>reference</code> corresponding to the level of the treatment to
use as the reference. Below, we set the reference to 0 (which is
arbitrary in this example because the treatment is on a log scale).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_bll_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reference_curve.html">reference_curve</a></span><span class="op">(</span><span class="va">adrf_bll</span>, reference <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>This produces a <code>reference_curve</code> object, which, when
printed, displays the reference level.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_bll_ref</span></span>
<span><span class="co">#&gt; An <span style="font-style: italic;">effect_curve</span> object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  - curve type: ADRF reference</span></span>
<span><span class="co">#&gt;  - response: Math</span></span>
<span><span class="co">#&gt;  - treatment: logBLL</span></span>
<span><span class="co">#&gt;    + range: -0.3567 to 2.4248</span></span>
<span><span class="co">#&gt;  - reference level: 0</span></span>
<span><span class="co">#&gt;  - inference: unconditional</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Use `plot()` (`?adrftools::plot.effect_curve()`) to plot</span> <span style="font-style: italic;">the curve, `summary()`</span> <span style="font-style: italic;">(`?adrftools::summary.effect_curve()`) to test the curve,</span> <span style="font-style: italic;">or `{object}(values)` (`?adrftools::effect_curve-class()`)</span> <span style="font-style: italic;">to compute estimates.</span></span></span></code></pre></div>
<p>We can plot the reference curve, which will essentially be the
original ADRF shifted so that the curve height at the reference level is
equal to 0.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_ref</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-18-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>Notice that the confidence bands narrow close for treatment levels
close to the reference level; we have greater certainty about ADRF
deviations from the its value at the reference level in that region.</p>
<p>We can use <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> to test whether the reference curve
is equal to 0 everywhere, which tests whether the ADRF differs from its
value at the reference level:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll_ref</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF difference from reference (logBLL = 0) is 0</span></span>
<span><span class="co">#&gt;     for values of logBLL between -0.3567 and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   P-value</span></span>
<span><span class="co">#&gt;  &lt; 0.0001</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span></code></pre></div>
<p>Theoretically, this is equivalent to testing whether the ADRF is flat
(no matter what the reference level is set to), though there may be
slight differences between the results of this test and those of the
test for flatness applied directly to the ADRF.</p>
<p>We can test whether individual values of the ADRF differ from the
value of the ADRF at the reference level by calling
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on the output of the <code>reference_curve</code>
object applied to the desired treatment levels:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">adrf_bll_ref</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  ADRF Reference Estimates</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  logBLL Estimate Std. Error      t  P-value  CI Low CI High</span></span>
<span><span class="co">#&gt;     0.5  -0.1113     0.1466 -0.760   0.7642 -0.4528  0.2301</span></span>
<span><span class="co">#&gt;     1.0  -0.3964     0.2127 -1.863   0.1452 -0.8918  0.0990</span></span>
<span><span class="co">#&gt;     1.5  -0.9598     0.2205 -4.354 &lt; 0.0001 -1.4732 -0.4464</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (t* = 2.329, df = 2401)</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Reference: logBLL = 0</span> | <span style="font-style: italic;">Null value: 0</span></span></span></code></pre></div>
<p>From this output, we can see that the value of the ADRF at
<code>logBLL = 1.5</code> differs from that at <code>logBLL = 0</code>
with a tiny p-value. The note below the table indicates the value of the
reference and the null value for the hypothesis tests.</p>
</div>
<div class="section level4">
<h4 id="the-amef">The AMEF<a class="anchor" aria-label="anchor" href="#the-amef"></a>
</h4>
<p>The AMEF is the derivative of the ADRF. Because it is a level of
abstraction away from the ADRF, it can be more challenging to interpret.
Each point on the AMEF represents the instantaneous effect of the
treatment on the outcome. Where the AMEF is 0, the ADRF is flat. In
<em>adrftools</em>, <code><a href="../reference/amef.html">amef()</a></code> can be used to compute the AMEF
by supplying to it an <code>adrf_curve</code> object.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">amef_bll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/amef.html">amef</a></span><span class="op">(</span><span class="va">adrf_bll</span><span class="op">)</span></span>
<span></span>
<span><span class="va">amef_bll</span></span>
<span><span class="co">#&gt; An <span style="font-style: italic;">effect_curve</span> object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  - curve type: AMEF</span></span>
<span><span class="co">#&gt;  - response: Math</span></span>
<span><span class="co">#&gt;  - treatment: logBLL</span></span>
<span><span class="co">#&gt;    + range: -0.3567 to 2.4248</span></span>
<span><span class="co">#&gt;  - inference: unconditional</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Use `plot()` (`?adrftools::plot.effect_curve()`) to plot</span> <span style="font-style: italic;">the curve, `summary()`</span> <span style="font-style: italic;">(`?adrftools::summary.effect_curve()`) to test the curve,</span> <span style="font-style: italic;">or `{object}(values)` (`?adrftools::effect_curve-class()`)</span> <span style="font-style: italic;">to compute estimates.</span></span></span></code></pre></div>
<p>The result is an <code>amef_curve</code> object, which, like all
<code>effect_curve</code> objects, is a function. We can plot the AMEF
with <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">amef_bll</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-22-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>Unlike when plotting the ADRF, plotting the AMEF automatically
includes a horizontal line with a y-intercept of 0. This can be
controlled with the <code>null</code> argument to
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.</p>
<p>We can compute estimates of the AMEF as specific values by supplying
those values to the <code>amef_curve</code> object and using
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> to examine its output:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">amef_bll</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       AMEF Estimates</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  logBLL Estimate Std. Error       t P-value  CI Low CI High</span></span>
<span><span class="co">#&gt;       0  -0.0982     0.5166 -0.1902  0.9965 -1.3313  1.1348</span></span>
<span><span class="co">#&gt;       1  -0.8166     0.6597 -1.2378  0.5133 -2.3911  0.7579</span></span>
<span><span class="co">#&gt;       2  -0.1605     0.6479 -0.2478  0.9923 -1.7068  1.3858</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (t* = 2.387, df = 2401)</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Null value: 0</span></span></span></code></pre></div>
<p>Here, a p-value for the test that the AMEF value is equal to 0 is
displayed along with confidence intervals. The null value for this test
can be controlled with the <code>null</code> argument to
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>.</p>
<p>Testing whether the AMEF is uniformly equal to 0 is theoretically
equivalent testing whether the ADRF is flat. We can perform this test
using <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on the <code>amef_curve</code> object
itself. The default value for <code>hypothesis</code> is 0 to test
whether the AMEF is 0 everywhere.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">amef_bll</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: AMEF is 0 for values of logBLL between -0.3567 and</span></span>
<span><span class="co">#&gt;     2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  P-value</span></span>
<span><span class="co">#&gt;   0.3528</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span></code></pre></div>
<p>Conclusions from the test that the ADRF is flat and that the AMEF is
0 may differ due to differing sensitivities to local alternatives
between the tests. More research is needed to understand these
differences. For now, we recommend not using the test for the AMEF and
instead testing the flatness of the ADRF directly.</p>
</div>
<div class="section level4">
<h4 id="subgroup-adrfs">Subgroup ADRFs<a class="anchor" aria-label="anchor" href="#subgroup-adrfs"></a>
</h4>
<p>The ADRF can be computed within subgroups to further probe the effect
of treatment for different unit profiles. To compute the ADRF in a
subgroup, one can simply use the <code>subset</code> argument to
<code><a href="../reference/adrf.html">adrf()</a></code> as one would in a call to <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>. The
supplied argument to <code>subset</code> should evaluate to a logical
vector using the data fit to the original model.</p>
<p>Below, we compute the ADRF of <code>logBLL</code> for the group
<code>Male == 0</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_bll_male_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">fit</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span>,</span>
<span>                        subset <span class="op">=</span> <span class="va">Male</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>All functionality for full-sample ADRFs can be used with a subgroup
ADRF.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_male_0</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-26-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>It’s also possible to compute the ADRF in multiple subgroups
simultaneously. To do so, one can use the <code>by</code> argument to
<code><a href="../reference/adrf.html">adrf()</a></code>, which accepts a one-sided formula with the
subgrouping variables on the right side.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_bll_by_male</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">fit</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span>,</span>
<span>                         by <span class="op">=</span> <span class="op">~</span><span class="va">Male</span><span class="op">)</span></span></code></pre></div>
<p>Printing the stratified <code>adrf_curve</code> object displays which
variables were supplied to <code>by</code>:</p>
<p>When we plot the ADRF, we can see curves for both groups:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_by_male</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-28-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>Indeed, all functions that operate on the ADRF or its estimates
produce results for all subgroups. Below, we test the null hypotheses
that the ADRF for each subgroup is flat:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll_by_male</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF is flat for values of logBLL between -0.3567</span></span>
<span><span class="co">#&gt;     and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Male  P-value</span></span>
<span><span class="co">#&gt;     0   0.0667</span></span>
<span><span class="co">#&gt;     1 &lt; 0.0001</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span></code></pre></div>
<p>We can reject the null hypothesis for the <code>Male = 1</code>
group, but not for the <code>Male = 0</code> group at the .05 level.</p>
<p>We can display ADRF estimates for each subgroup by supplying values
of the treatment to the <code>adrf_curve</code> object and calling
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on its output:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">adrf_bll_by_male</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 ADRF Estimates</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  Male logBLL Estimate Std. Error CI Low CI High</span></span>
<span><span class="co">#&gt;     0      0    8.469     0.2351  7.850   9.088</span></span>
<span><span class="co">#&gt;     0      1    8.460     0.1523  8.059   8.861</span></span>
<span><span class="co">#&gt;     0      2    7.619     0.3274  6.757   8.480</span></span>
<span><span class="co">#&gt;     1      0    8.375     0.2392  7.746   9.005</span></span>
<span><span class="co">#&gt;     1      1    7.605     0.1641  7.173   8.036</span></span>
<span><span class="co">#&gt;     1      2    6.689     0.2833  5.943   7.434</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (t* = 2.631, df = 2401)</span></span></span></code></pre></div>
<p>Columns for the subgrouping variables are displayed on the left.</p>
<p>When we project the ADRFs onto a linear model, we also get separate
projection coefficients for each subgroup:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">proj_by_male</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/curve_projection.html">curve_projection</a></span><span class="op">(</span><span class="va">adrf_bll_by_male</span>, <span class="st">"linear"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Coefficient estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">proj_by_male</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    ADRF Projection Coefficients</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  Male        Term Estimate Std. Error     t  P-value CI Low CI High</span></span>
<span><span class="co">#&gt;     0 (Intercept)    8.623     0.1867 46.18 &lt; 0.0001  8.256   8.989</span></span>
<span><span class="co">#&gt;     0      logBLL   -0.441     0.1863 -2.37   0.0180 -0.806  -0.076</span></span>
<span><span class="co">#&gt;     1 (Intercept)    8.353     0.1871 44.65 &lt; 0.0001  7.986   8.720</span></span>
<span><span class="co">#&gt;     1      logBLL   -0.779     0.1720 -4.53 &lt; 0.0001 -1.116  -0.441</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (t* = 1.961, df = 2401)</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Null value: 0</span></span></span>
<span></span>
<span><span class="co"># Projection plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">proj_by_male</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-31-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># ADRF plot with projection</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_by_male</span>, proj <span class="op">=</span> <span class="va">proj_by_male</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-31-2.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>Note that any corrections for multiple comparisons when
<code>simultaneous = TRUE</code> in <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> and
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> will be made accounting for all subgroups, which
can quickly escalate with the additional estimates within subgroups.</p>
<p>To display results for a subset of the subgroups,
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, the <code>adrf_curve</code> object, and
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> all accept a <code>subset</code> argument that
works like that supplied to <code><a href="../reference/adrf.html">adrf()</a></code>, but it operates only on
the subgroup estimates included in the <code>ardf_curve</code> object by
the <code>by</code> argument. For example, to plot each of the subgroups
separately, we can use the following:</p>
</div>
<div class="section level4 tabset unlisted unnumbered">
<h4 class="tabset unlisted unnumbered" id="section"></h4>


<ul class="nav nav-tabs" id="section" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#male-0" id="male-0-tab" type="button" role="tab" aria-controls="male-0" aria-selected="true" class="active nav-link"><code>Male = 0</code></button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#male-1" id="male-1-tab" type="button" role="tab" aria-controls="male-1" aria-selected="false" class="nav-link"><code>Male = 1</code></button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="male-0" role="tabpanel" aria-labelledby="male-0-tab">

<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_by_male</span>, subset <span class="op">=</span> <span class="va">Male</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-32-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
</div>
<div class="tab-pane" id="male-1" role="tabpanel" aria-labelledby="male-1-tab">

<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_by_male</span>, subset <span class="op">=</span> <span class="va">Male</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-33-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level4 unlisted unnumbered">
<h4 class="unlisted unnumbered" id="section-1"></h4>
<p>This produces the same output as plotting the ADRF computed by
supplying <code>subset</code> to <code><a href="../reference/adrf.html">adrf()</a></code> with the same
arguments. We can do the same with other functions as well:</p>
</div>
<div class="section level4 tabset unlisted unnumbered">
<h4 class="tabset unlisted unnumbered" id="section-2"></h4>


<ul class="nav nav-tabs" id="section-2" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#male-0-1" id="male-0-1-tab" type="button" role="tab" aria-controls="male-0-1" aria-selected="true" class="active nav-link"><code>Male = 0</code></button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#male-1-1" id="male-1-1-tab" type="button" role="tab" aria-controls="male-1-1" aria-selected="false" class="nav-link"><code>Male = 1</code></button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="male-0-1" role="tabpanel" aria-labelledby="male-0-1-tab">

<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Testing whether the ADRF is flat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll_by_male</span>, subset <span class="op">=</span> <span class="va">Male</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF is flat for values of logBLL between -0.3567</span></span>
<span><span class="co">#&gt;     and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Male P-value</span></span>
<span><span class="co">#&gt;     0  0.0667</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span>
<span></span>
<span><span class="co"># Estimates along the ADRF</span></span>
<span><span class="fu">adrf_bll_by_male</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, subset <span class="op">=</span> <span class="va">Male</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 ADRF Estimates</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  Male logBLL Estimate Std. Error CI Low CI High</span></span>
<span><span class="co">#&gt;     0      0    8.469     0.2351  7.908   9.030</span></span>
<span><span class="co">#&gt;     0      1    8.460     0.1523  8.096   8.823</span></span>
<span><span class="co">#&gt;     0      2    7.619     0.3274  6.837   8.400</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (t* = 2.386, df = 2401)</span></span></span></code></pre></div>
</div>
<div class="tab-pane" id="male-1-1" role="tabpanel" aria-labelledby="male-1-1-tab">

<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Testing whether the ADRF is flat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll_by_male</span>, subset <span class="op">=</span> <span class="va">Male</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF is flat for values of logBLL between -0.3567</span></span>
<span><span class="co">#&gt;     and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Male  P-value</span></span>
<span><span class="co">#&gt;     1 &lt; 0.0001</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span>
<span></span>
<span><span class="co"># Estimates along the ADRF</span></span>
<span><span class="fu">adrf_bll_by_male</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, subset <span class="op">=</span> <span class="va">Male</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 ADRF Estimates</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  Male logBLL Estimate Std. Error CI Low CI High</span></span>
<span><span class="co">#&gt;     1      0    8.375     0.2392  7.804   8.946</span></span>
<span><span class="co">#&gt;     1      1    7.605     0.1640  7.213   7.996</span></span>
<span><span class="co">#&gt;     1      2    6.689     0.2833  6.012   7.365</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (t* = 2.386, df = 2401)</span></span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level4 unlisted unnumbered">
<h4 class="unlisted unnumbered" id="section-3"></h4>
<p>Notice the critical <span class="math inline">\(t\)</span> value
(displayed as <code>t*</code> in the output) differs when examining
estimates within a subgroup and including both subgroups because the
adjustment to the value for simultaneous inference is smaller with fewer
estimates.</p>
</div>
<div class="section level4">
<h4 id="subgroup-adrf-contrasts">Subgroup ADRF contrasts<a class="anchor" aria-label="anchor" href="#subgroup-adrf-contrasts"></a>
</h4>
<p>When <code>by</code> is used to compute the ADRF within subgroups, we
compute a new effect curve corresponding to the contrast between
subgroup ADRFs. Using <code><a href="../reference/curve_contrast.html">curve_contrast()</a></code> produces a
<code>contrast_curve</code> object, which is an
<code>effect_curve</code> object.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_bll_male_contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/curve_contrast.html">curve_contrast</a></span><span class="op">(</span><span class="va">adrf_bll_by_male</span><span class="op">)</span></span></code></pre></div>
<p>Printing the object displays the contrast(s) computed. With more than
two subgroups, all pairs of subgroups are compared.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_bll_male_contrast</span></span>
<span><span class="co">#&gt; An <span style="font-style: italic;">effect_curve</span> object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  - curve type: ADRF contrast</span></span>
<span><span class="co">#&gt;  - response: Math</span></span>
<span><span class="co">#&gt;  - treatment: logBLL</span></span>
<span><span class="co">#&gt;    + range: -0.3567 to 2.4248</span></span>
<span><span class="co">#&gt;  - contrast: [Male = 1] - [Male = 0]</span></span>
<span><span class="co">#&gt;  - inference: unconditional</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Use `plot()` (`?adrftools::plot.effect_curve()`) to plot</span> <span style="font-style: italic;">the curve, `summary()`</span> <span style="font-style: italic;">(`?adrftools::summary.effect_curve()`) to test the curve,</span> <span style="font-style: italic;">or `{object}(values)` (`?adrftools::effect_curve-class()`)</span> <span style="font-style: italic;">to compute estimates.</span></span></span></code></pre></div>
<p>We can plot the difference between the two ADRFs using
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_male_contrast</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-38-1.png" class="r-plt" width="691.2" style="display: block; margin: auto;"></p>
<p>Here, the y-axis corresponds to the difference between the subgroup
ADRF estimates, and a horizontal line at 0 is displayed. We can use
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> to test whether the ADRF contrast curve is equal
to 0 everywhere, which would indicate that the ADRF does not differ
across subgroups:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll_male_contrast</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF contrast is 0 for values of logBLL between</span></span>
<span><span class="co">#&gt;     -0.3567 and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 Contrast P-value</span></span>
<span><span class="co">#&gt;  [Male = 1] - [Male = 0]    0.01</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span></code></pre></div>
<p>Given the small p-value, we can reject the null hypothesis that the
ADRF contrast is 0, implying the subgroup ADRFs differ from each
other.</p>
<p>We can use <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on the output of the
<code>contrast_curve</code> object to test for differences between the
subgroup ADRFs at specific points:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">adrf_bll_male_contrast</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                          ADRF Contrast Estimates</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;                 Contrast logBLL Estimate Std. Error      t P-value  CI Low</span></span>
<span><span class="co">#&gt;  [Male = 1] - [Male = 0]      0  -0.0938     0.3354 -0.280  0.9890 -0.8942</span></span>
<span><span class="co">#&gt;  [Male = 1] - [Male = 0]      1  -0.8551     0.2239 -3.820  0.0004 -1.3892</span></span>
<span><span class="co">#&gt;  [Male = 1] - [Male = 0]      2  -0.9300     0.4329 -2.148  0.0914 -1.9631</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (t* = 2.386, df = 2401)</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Null value: 0</span></span></span></code></pre></div>
<p>Here we see evidence that the ADRF values at <code>logBLL = 1</code>
differ between the <code>Male = 1</code> and <code>Male = 0</code>
subgroups.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="additional-scenarios">Additional Scenarios<a class="anchor" aria-label="anchor" href="#additional-scenarios"></a>
</h2>
<p>Above, we demonstrated the basic use of <em>adrftools</em> with a
linear outcome model. Often, analyses are more complicated. For example,
we might be in a scenario with missing data, survey weights, inverse
probability weighting, nonlinear models, etc. Below, we briefly explain
how to modify the above procedures to deal with these issues.</p>
<div class="section level3">
<h3 id="nonlinear-outcome-models">Nonlinear outcome models<a class="anchor" aria-label="anchor" href="#nonlinear-outcome-models"></a>
</h3>
<p>If our outcome is binary, we may use a logistic regression to fit the
outcome model instead of a linear model. This adds an additional
complication because many of the procedures in <em>adrftools</em> assume
linearity of the quantities being analyzed. In general, though,
<em>adrftools</em> works smoothly with nonlinear models, such as
generalized linear models. Below, we demonstrate some of the differences
when dealing with such models.</p>
<p>For our outcome, we will use a binarized version of
<code>Block</code>, <code>Block_bin</code>, which is 1 if
<code>Block</code> is 12 or greater and 0 otherwise. We’ll create that
variable below and use it as the outcome of our outcome model:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhanes3lead</span><span class="op">$</span><span class="va">Block_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">nhanes3lead</span><span class="op">$</span><span class="va">Block</span> <span class="op">&gt;=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">nhanes3lead</span><span class="op">$</span><span class="va">Block_bin</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    0    1 </span></span>
<span><span class="co">#&gt; 2049  472</span></span>
<span></span>
<span><span class="va">fit_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Block_bin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">logBLL</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span></span>
<span>                 <span class="op">(</span><span class="va">Age</span> <span class="op">+</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span> <span class="va">Smoke_in_Home</span> <span class="op">+</span></span>
<span>                    <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">nhanes3lead</span>,</span>
<span>               family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code></pre></div>
<p>To compute the ADRF, we simply call <code><a href="../reference/adrf.html">adrf()</a></code>. We can
supply the <code>type</code> argument, which specifies the type of
prediction to use. The default, <code>type = "response"</code>, computes
the ADRF on the probability scale, which is the most natural for a
binary outcome.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_bll_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">fit_bin</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span><span class="op">)</span></span></code></pre></div>
<p>We can plot the ADRF with <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-43-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>An important thing to notice is that the confidence bands are
asymmetrical. This is because symmetrical Wald confidence bands are
first computed on transformed versions of the ADRF estimates before
being back-transformed to be on the original scale. This isn’t the same
as computing the ADRF on the linear predictor of the outcome model
(i.e., by specifying <code>type = "link"</code> in the call to
<code><a href="../reference/adrf.html">adrf()</a></code>); this involves computing the ADRF as usual on the
original (probability scale), transforming the ADRF estimates, using the
delta method to compute the variance of the transformed estimates, and
then computing Wald confidence bands using the variance of the
transformed estimates before back-transforming<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that the confidence bands are symmetrical when a
scaling corresponding to the transformation is applied to the y-axis; to
see this, run
&lt;code&gt;plot(adrf_bll_bin) + ggplot2::scale_y_continuous(transform = "logit")&lt;/code&gt;&lt;/p&gt;'><sup>1</sup></a>. This ensures the
confidence bands respect the bounds implied by the link function used in
the outcome model.</p>
<p>To instead compute symmetric confidence bands around the original
ADRF estimates, one can specify <code>transform = FALSE</code> to
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. This produces the same ADRF line, but the
confidence bands will be symmetrical around it, which means it is
possible for the confidence bands to fall outside 0 and 1, as they do
below:</p>
<div class="section level4 tabset unlisted unnumbered">
<h4 class="tabset unlisted unnumbered" id="section-4"></h4>


<ul class="nav nav-tabs" id="section-4" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#transformed" id="transformed-tab" type="button" role="tab" aria-controls="transformed" aria-selected="false" class="nav-link">Transformed</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#untransformed" id="untransformed-tab" type="button" role="tab" aria-controls="untransformed" aria-selected="true" class="nav-link active">Untransformed</button></li>
</ul>
<div class="tab-content">
<div class="tab-pane" id="transformed" role="tabpanel" aria-labelledby="transformed-tab">

<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.03</span>, <span class="fl">.37</span><span class="op">)</span>, expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-44-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
</div>
<div class="active tab-pane" id="untransformed" role="tabpanel" aria-labelledby="untransformed-tab">

<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span>, transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.03</span>, <span class="fl">.37</span><span class="op">)</span>, expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-45-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level4 unlisted unnumbered">
<h4 class="unlisted unnumbered" id="section-5"></h4>
<p>Bootstrapping and using a percentile confidence bands avoids this
issue because such bands are invariant to transformation and respect the
bounds of the outcome.</p>
<p><code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> applied to the ADRF point estimates also has a
<code>transform</code> argument for the same purpose; by default, it
computes transformed confidence intervals.</p>
</div>
<div class="section level4 tabset unlisted unnumbered">
<h4 class="tabset unlisted unnumbered" id="section-6"></h4>


<ul class="nav nav-tabs" id="section-6" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#transformed-1" id="transformed-1-tab" type="button" role="tab" aria-controls="transformed-1" aria-selected="true" class="active nav-link">Transformed</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#untransformed-1" id="untransformed-1-tab" type="button" role="tab" aria-controls="untransformed-1" aria-selected="false" class="nav-link">Untransformed</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="transformed-1" role="tabpanel" aria-labelledby="transformed-1-tab">

<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">adrf_bll_bin</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         ADRF Estimates</span></span>
<span><span class="co">#&gt; ───────────────────────────────</span></span>
<span><span class="co">#&gt;  logBLL Estimate CI Low CI High</span></span>
<span><span class="co">#&gt;       0   0.2420 0.1930  0.2988</span></span>
<span><span class="co">#&gt;       1   0.1925 0.1602  0.2296</span></span>
<span><span class="co">#&gt;       2   0.0752 0.0396  0.1383</span></span>
<span><span class="co">#&gt; ───────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (z* = 2.386)</span></span></span></code></pre></div>
</div>
<div class="tab-pane" id="untransformed-1" role="tabpanel" aria-labelledby="untransformed-1-tab">

<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">adrf_bll_bin</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span>transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;               ADRF Estimates</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  logBLL Estimate Std. Error CI Low CI High</span></span>
<span><span class="co">#&gt;       0   0.2420     0.0222 0.1890  0.2949</span></span>
<span><span class="co">#&gt;       1   0.1925     0.0145 0.1579  0.2272</span></span>
<span><span class="co">#&gt;       2   0.0752     0.0198 0.0279  0.1225</span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (z* = 2.386)</span></span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level4 unlisted unnumbered">
<h4 class="unlisted unnumbered" id="section-7"></h4>
<p>When <code>transform = FALSE</code>, standard errors are displayed;
otherwise, they are omitted because the computed standard errors are on
the transformed estimates. Note that regardless of
<code>transform</code>, all estimates and confidence intervals are
reported on the scale of the original prediction type (in this case,
probabilities). <code>transform</code> only changes how the confidence
intervals are computed.</p>
<p><code>transform</code> can be <code>TRUE</code>, <code>FALSE</code>,
a <code>family</code> object, or a function. When <code>TRUE</code> (the
default for all <em>adrftools</em> functions that use it), the link
function of the outcome model will be used. When a <code>family</code>
object is supplied, its link function will be used. When a function is
supplied, it will be used as the transformation. Typically a
transformation function takes in as input the estimate on the outcome
scale (e.g., probabilities for binary outcomes) and returns a quantity
on an unbounded scale; examples include <code><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis()</a></code> and
<code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm()</a></code> for binary outcomes (corresponding to logistic and
probit links) and <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> for count outcomes.</p>
<p>When projecting the ADRF onto a simpler model, one has the option of
specifying the projection either as a transformation of the linear
predictor or as the linear predictor itself (i.e., untransformed). For
example, with a binary outcome and a logistic transformation, specifying
the projection as a transformation will yield a logistic (S-shaped)
curve, whereas specifying the projection as the linear predictor will
yield a straight line. For a transformation <span class="math inline">\(g(\mu)\)</span> with inverse <span class="math inline">\(g^{-1}(\eta)\)</span> (e.g., <span class="math inline">\(g(\mu) = \log{\frac{\mu}{1-\mu}}\)</span> with
<span class="math inline">\(g^{-1}(\eta) = \frac{1}{1 +
\exp(-\eta)}\)</span>), the transformed projection is estimated by
minimizing</p>
<p><span class="math display">\[
\int_{a_\text{low}}^{a_\text{high}}{\left(\hat{\theta}(a)-g^{-1}\left(\hat{P}(a)\right)\right)^2
\,da}
\]</span></p>
<p>where <span class="math inline">\(\hat{P}(a)\)</span> is the linear
predictor of the projection model evaluated at treatment value <span class="math inline">\(a\)</span> (e.g., <span class="math inline">\(\hat{P}(a)=\hat{b}_0 + \hat{b}_1 a\)</span> for a
simple linear projection model). The projection is estimated using
nonlinear least-squares, with propagation of the uncertainty in the ADRF
carried through using the delta method.</p>
<p>The choice of whether to use a transformed projection or an
untransformed projection affects the output of <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>
and <code><a href="../reference/curve_projection.html">curve_projection()</a></code>, both of which involve a projection
of the ADRF. When transformation is requested with
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> (the default), the null hypothesis tested is
whether the ADRF is sufficiently described by the transformed linear
predictor. For example, consider a scenario in which the true ADRF is
S-shaped. Testing whether ADRF is linear <strong>without</strong>
transformation corresponds to testing whether the ADRF is more
complicated than a straight line, and therefore will likely yield
rejection of the null hypothesis (i.e., because a straight line is not
sufficient to characterize the S-shaped ADRF). Testing whether the ADRF
is linear <strong>with</strong> transformation corresponds to testing
whether the ADRF is more complicated than an S-shaped curve, and
therefore will likely yield a failure to reject the null hypothesis
(i.e., because the S-shaped curve is sufficient to characterize the
ADRF). The correct choice depends on the specifics of the research
question and context.</p>
<p>When testing whether the ADRF is flat, the test using the transformed
linear predictor is typically equivalent to that using the linear
predictor itself; ideally these tests should yield the same conclusion.
When testing whether the ADRF is equal to a given value, the test
back-transforms the ADRF estimate and the given value before computing
the test statistic.</p>
<p>In the tabbed output below, we run <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and
<code><a href="../reference/curve_projection.html">curve_projection()</a></code> with and without transformation:</p>
</div>
<div class="section level4 tabset unlisted unnumbered">
<h4 class="tabset unlisted unnumbered" id="section-8"></h4>


<ul class="nav nav-tabs" id="section-8" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#transformed-2" id="transformed-2-tab" type="button" role="tab" aria-controls="transformed-2" aria-selected="true" class="active nav-link">Transformed</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#untransformed-2" id="untransformed-2-tab" type="button" role="tab" aria-controls="untransformed-2" aria-selected="false" class="nav-link">Untransformed</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="transformed-2" role="tabpanel" aria-labelledby="transformed-2-tab">

<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test for flatness</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF is flat (transformed) for values of logBLL</span></span>
<span><span class="co">#&gt;     between -0.3567 and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   P-value</span></span>
<span><span class="co">#&gt;  &lt; 0.0001</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span>
<span></span>
<span><span class="co"># Test for linearity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span>, <span class="st">"linear"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF is linear (transformed) for values of logBLL</span></span>
<span><span class="co">#&gt;     between -0.3567 and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  P-value</span></span>
<span><span class="co">#&gt;    0.144</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span>
<span></span>
<span><span class="co"># Estimate projection on transformed ADRF</span></span>
<span><span class="va">proj_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/curve_projection.html">curve_projection</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span>, <span class="st">"linear"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">proj_t</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   ADRF Projection Coefficients</span></span>
<span><span class="co">#&gt; ─────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;         Term Estimate Std. Error       z  P-value  CI Low CI High</span></span>
<span><span class="co">#&gt;  (Intercept)  -1.0964     0.0941 -11.653 &lt; 0.0001 -1.2808  -0.912</span></span>
<span><span class="co">#&gt;       logBLL  -0.5373     0.0996  -5.392 &lt; 0.0001 -0.7325  -0.342</span></span>
<span><span class="co">#&gt; ─────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (z* = 1.96)</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Null value: 0</span></span></span></code></pre></div>
</div>
<div class="tab-pane" id="untransformed-2" role="tabpanel" aria-labelledby="untransformed-2-tab">

<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test for flatness</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span>, transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF is flat for values of logBLL between -0.3567</span></span>
<span><span class="co">#&gt;     and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   P-value</span></span>
<span><span class="co">#&gt;  &lt; 0.0001</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span>
<span></span>
<span><span class="co"># Test for linearity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span>, <span class="st">"linear"</span>, transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   Omnibus Curve Test</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; H₀: ADRF is linear for values of logBLL between</span></span>
<span><span class="co">#&gt;     -0.3567 and 2.4248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  P-value</span></span>
<span><span class="co">#&gt;   0.5193</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Computed using the Imhof approximation</span></span></span>
<span></span>
<span><span class="co"># Estimate projection on untransformed ADRF</span></span>
<span><span class="va">proj_u</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/curve_projection.html">curve_projection</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span>, <span class="st">"linear"</span>, transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">proj_u</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   ADRF Projection Coefficients</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;         Term Estimate Std. Error      z  P-value  CI Low CI High</span></span>
<span><span class="co">#&gt;  (Intercept)   0.2497     0.0162 15.396 &lt; 0.0001  0.2179  0.2815</span></span>
<span><span class="co">#&gt;       logBLL  -0.0788     0.0133 -5.936 &lt; 0.0001 -0.1048 -0.0528</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: unconditional</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95% (z* = 1.96)</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Null value: 0</span></span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level4 unlisted unnumbered">
<h4 class="unlisted unnumbered" id="section-9"></h4>
</div>
<div class="section level4 tabset unlisted unnumbered">
<h4 class="tabset unlisted unnumbered" id="section-10"></h4>


<ul class="nav nav-tabs" id="section-10" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#transformed-3" id="transformed-3-tab" type="button" role="tab" aria-controls="transformed-3" aria-selected="true" class="active nav-link">Transformed</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#untransformed-3" id="untransformed-3-tab" type="button" role="tab" aria-controls="untransformed-3" aria-selected="false" class="nav-link">Untransformed</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="transformed-3" role="tabpanel" aria-labelledby="transformed-3-tab">

<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot transformed projection</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">proj_t</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-50-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span>, proj <span class="op">=</span> <span class="va">proj_t</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-50-2.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
</div>
<div class="tab-pane" id="untransformed-3" role="tabpanel" aria-labelledby="untransformed-3-tab">

<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot untransformed projection</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">proj_u</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-51-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_bin</span>, proj <span class="op">=</span> <span class="va">proj_u</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-51-2.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level4 unlisted unnumbered">
<h4 class="unlisted unnumbered" id="section-11"></h4>
<p>Notice that the projections appear someone different depending on
whether transformation is requested. If so (the default), the projection
coefficients are interpreted like those from a generalized linear model
of the outcome on the treatment with the transformation as the given
link function (in this case, on the log odds scale). The projection is
curved to reflect the nonlinear relationship implied by the
transformation. If not, the projection coefficients are interpreted
directly as though fitted with a linear model, and the projection is
linear. Transformed projections may be more realistic by respecting the
scale of the outcome, but their coefficients can be harder to
interpret.</p>
<p>In the example above, the untransformed linear projection appear to
fit the ADRF slightly better; it would be reasonable to say that in the
observed treatment range, the ADRF can be sufficiently described as
linear. However, knowing that the outcome is bounded by 0 and 1, we know
the ADRF cannot be linear across the entirety of the real number
line.</p>
</div>
</div>
<div class="section level3">
<h3 id="balancing-weights">Balancing weights<a class="anchor" aria-label="anchor" href="#balancing-weights"></a>
</h3>
<p>G-computation typically requires unlikely conditions to be met in
order to be effective at adjusting for confounding. Those conditions can
be weakened by first weighting the sample so that the treatment is
independent of the covariates. After weighting, one can either use
g-computation in the weighted sample or simply fit an unconditional
dose-response function without further adjusting for covariates, in
which case the estimated dose-response function corresponds to the
ADRF.</p>
<p><em>adrftools</em> can handle weighted samples in a straightforward
way. Nothing needs to change from the previous scenarios; the only issue
to be concerned about is the need to refit the weighting model when
bootstrapping for uncertainty estimation. Fortunately, functionality in
<em>WeightIt</em> makes this straightforward. If using <em>WeightIt</em>
to estimate weights, one can use one of <em>WeightIt</em>’s built-in
outcome modeling functions like <code><a href="https://ngreifer.github.io/WeightIt/reference/glm_weightit.html" class="external-link">glm_weightit()</a></code> to fit the
outcome model. See an example below, in which we first estimate
balancing weights using generalized propensity score weighting.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ngreifer.github.io/WeightIt/" class="external-link">WeightIt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">w_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">logBLL</span> <span class="op">~</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span></span>
<span>                    <span class="va">Smoke_in_Home</span> <span class="op">+</span> <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">nhanes3lead</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">"glm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">w_fit</span></span>
<span><span class="co">#&gt; A <span style="font-style: italic;">weightit</span> object</span></span>
<span><span class="co">#&gt;  - method: "glm" (propensity score weighting with GLM)</span></span>
<span><span class="co">#&gt;  - number of obs.: 2521</span></span>
<span><span class="co">#&gt;  - sampling weights: none</span></span>
<span><span class="co">#&gt;  - treatment: continuous</span></span>
<span><span class="co">#&gt;  - covariates: Male, Age, Race, PIR, Enough_Food, Smoke_in_Home, Smoke_Pregnant, NICU</span></span></code></pre></div>
<p>Normally, we would assess balance on the weights, but we’ll skip that
here (see <code><a href="https://ngreifer.github.io/cobalt/articles/cobalt.html" class="external-link">vignette("cobalt", package = "cobalt")</a></code> for
details on how to do this). We’ll use <code><a href="https://ngreifer.github.io/WeightIt/reference/glm_weightit.html" class="external-link">glm_weightit()</a></code> to fit
a linear model for <code>Math</code>, incorporating the estimation of
the weights into the variance of the outcome model parameters.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/glm_weightit.html" class="external-link">glm_weightit</a></span><span class="op">(</span><span class="va">Math</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">logBLL</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span></span>
<span>                      <span class="op">(</span><span class="va">Age</span> <span class="op">+</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span> <span class="va">Smoke_in_Home</span> <span class="op">+</span></span>
<span>                         <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">nhanes3lead</span>,</span>
<span>                    weightit <span class="op">=</span> <span class="va">w_fit</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can use <code><a href="../reference/adrf.html">adrf()</a></code> to compute the ADRF, just as
we did with the output of <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_bll_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">fit</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_w</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-54-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="sampling-weights">Sampling weights<a class="anchor" aria-label="anchor" href="#sampling-weights"></a>
</h3>
<p>Sampling weights can be a bit more complicated than balancing
weights; in addition to using the weights to fit the outcome model, the
sampling weights need to be incorporated into the g-computation
procedure to estimate the ADRF. For outcome models fit with
<code><a href="https://rdrr.io/pkg/survey/man/svyglm.html" class="external-link">survey::svyglm()</a></code>, no special operation is required—the
sampling weights are automatically incorporated into the estimation and
variance estimates.</p>
<p>If sampling weights are used with another model or are not included
in a model, the <code>wts</code> argument to <code><a href="../reference/adrf.html">adrf()</a></code> needs
to be specified. <code>wts</code> can be <code>TRUE</code> to use the
weights used to fit the outcome model, a string containing the name of
the variable in the original dataset containing the sampling weights, or
a vector of sampling weights. In general, it’s best to use a model that
automatically incorporates the sampling weights; <code>wts</code> should
typically not be specified.</p>
<p>In the <code>nhanes3lead</code> dataset, the <code>MEC_wt</code>
variable contains sampling weights. Below, we’ll demonstrate three
common approaches to incorporating sampling weights: 1) using
<code><a href="https://rdrr.io/pkg/survey/man/svyglm.html" class="external-link">survey::svyglm()</a></code>, 2) using the <code>s.weights</code>
argument in <code><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">WeightIt::weightit()</a></code>, and 3) using the
<code>weights</code> argument in <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>; only the last of
these three requires using the the <code>wts</code> argument.</p>
<div class="section level4">
<h4 id="using-survey">Using <em>survey</em><a class="anchor" aria-label="anchor" href="#using-survey"></a>
</h4>
<p>First, we’ll use <em>survey</em> functionality to incorporate
sampling weights.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">des</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, weights <span class="op">=</span> <span class="op">~</span><span class="va">MEC_wt</span>, data <span class="op">=</span> <span class="va">nhanes3lead</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyglm.html" class="external-link">svyglm</a></span><span class="op">(</span><span class="va">Math</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">logBLL</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span></span>
<span>                   <span class="op">(</span><span class="va">Age</span> <span class="op">+</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span> <span class="va">Smoke_in_Home</span> <span class="op">+</span></span>
<span>                      <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span><span class="op">)</span>,</span>
<span>                 design <span class="op">=</span> <span class="va">des</span><span class="op">)</span></span></code></pre></div>
<p>Simply calling <code><a href="../reference/adrf.html">adrf()</a></code> automatically incorporates
sampling weights.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">fit_sv</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_sv</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-56-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="using-glm">Using <code>glm()</code><a class="anchor" aria-label="anchor" href="#using-glm"></a>
</h4>
<p>If the survey design is simple and can be captured using weights
alone (i.e., without stratification or clustering), <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>
with the <code>weights</code> argument can be used instead of
<code><a href="https://rdrr.io/pkg/survey/man/svyglm.html" class="external-link">svyglm()</a></code>. A special standard error is required for the
estimates to be valid, but <code><a href="../reference/adrf.html">adrf()</a></code> calculates that standard
error automatically when <code>vcov = "unconditional"</code> (the
default).</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Math</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">logBLL</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span></span>
<span>               <span class="op">(</span><span class="va">Age</span> <span class="op">+</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span> <span class="va">Smoke_in_Home</span> <span class="op">+</span></span>
<span>                  <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span><span class="op">)</span>,</span>
<span>             data <span class="op">=</span> <span class="va">nhanes3lead</span>,</span>
<span>             weights <span class="op">=</span> <span class="va">MEC_wt</span><span class="op">)</span></span></code></pre></div>
<p>With <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>, we need to set <code>wts = TRUE</code> in
the call to <code><a href="../reference/adrf.html">adrf()</a></code> to ensure the weights are properly
included in the ADRF estimation. If not, the weights will be used only
in fitting the outcome mode, but the ADRF will generalize to the
unweighted population. This is okay if the weights are balancing
weights, but if they are sampling weights, it is critical for them to be
incorporated into the ADRF as well.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">fit_gs</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span>,</span>
<span>                wts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_gs</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-58-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>Using <code>wts = "MEC_wts"</code> would yield the same results and
can be used if the weights used to fit the outcome model are different
from those used to generalized the ADRF (as we will see below when
combining sampling and balancing weights).</p>
</div>
<div class="section level4">
<h4 id="sampling-weights-and-balancing-weights-together">Sampling weights and balancing weights together<a class="anchor" aria-label="anchor" href="#sampling-weights-and-balancing-weights-together"></a>
</h4>
<p>If you want to use balancing weights in a sampling-weighted sample,
some additional considerations are required. Importantly, the product of
the sampling weights and balancing weights is used to fit the outcome
model, but the ADRF is computed incorporating the sampling weights
alone. Doing this with <em>WeightIt</em> is the most straightforward;
simply supplying the <code>s.weights</code> argument to
<code><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit()</a></code> makes everything work as expected. They are
automatically included in the outcome model when fit with
<code><a href="https://ngreifer.github.io/WeightIt/reference/glm_weightit.html" class="external-link">glm_weightit()</a></code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that this same procedure be used without actually
estimating balancing weights by setting &lt;code&gt;method = NULL&lt;/code&gt; in
the call to &lt;code&gt;&lt;a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link"&gt;weightit()&lt;/a&gt;&lt;/code&gt;. This yields the same results as the
previous two methods.&lt;/p&gt;'><sup>2</sup></a>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ngreifer.github.io/WeightIt/" class="external-link">WeightIt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">w_sw_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">logBLL</span> <span class="op">~</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span></span>
<span>                       <span class="va">Smoke_in_Home</span> <span class="op">+</span> <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">nhanes3lead</span>,</span>
<span>                     method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>                     s.weights <span class="op">=</span> <span class="st">"MEC_wt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_sw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/glm_weightit.html" class="external-link">glm_weightit</a></span><span class="op">(</span><span class="va">Math</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">logBLL</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span></span>
<span>                         <span class="op">(</span><span class="va">Age</span> <span class="op">+</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span> <span class="va">Smoke_in_Home</span> <span class="op">+</span></span>
<span>                            <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span><span class="op">)</span>,</span>
<span>                       data <span class="op">=</span> <span class="va">nhanes3lead</span>,</span>
<span>                       weightit <span class="op">=</span> <span class="va">w_sw_fit</span><span class="op">)</span></span></code></pre></div>
<p>By default, <code><a href="../reference/adrf.html">adrf()</a></code> uses the sampling weights, but not
the balancing weights, in standardizing the ADRF estimate. This ensures
the estimates generalize to the sampling-weighted sample<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;If, for some reason, you want to include the product of
the sampling weights and balancing weights in the estimation of the
ADRF, set &lt;code&gt;wts = TRUE&lt;/code&gt; instead of leaving it unspecified.&lt;/p&gt;"><sup>3</sup></a>.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_sw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">fit_sw</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_sw</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-60-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="other-scenarios">Other scenarios<a class="anchor" aria-label="anchor" href="#other-scenarios"></a>
</h4>
<p>In general, <code>wts</code> can accept one of a few arguments.
Leaving it <code>NULL</code>, as we did in two of the cases above,
automatically includes the weights in the estimation of the ADRF if the
outcome model is fit using <code><a href="https://rdrr.io/pkg/survey/man/svyglm.html" class="external-link">svyglm()</a></code> or using
<code><a href="https://ngreifer.github.io/WeightIt/reference/glm_weightit.html" class="external-link">glm_weightit()</a></code> with <code>s.weights</code> supplied in the
original call to <code><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit()</a></code>. Otherwise, weights are not
included. To use the same weights in the ADRF that were used to fit the
outcome model, set <code>wts = TRUE</code>, as we did in the
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> example above. To use a set of weights in the ADRF
different from those used to fit the outcome model, supply the names of
the weights as a string or a numeric vector containing the weights to
<code>wts</code>. This should be done if, for example, the product of
sampling weights and balancing weights was used to fit the outcome model
but only the sampling weights are to be used in computing the ADRF (and
this was done without using <code><a href="https://ngreifer.github.io/WeightIt/reference/glm_weightit.html" class="external-link">glm_weightit()</a></code>, which
automatically uses the correct calculation).</p>
</div>
</div>
<div class="section level3">
<h3 id="multiply-imputed-data">Multiply imputed data<a class="anchor" aria-label="anchor" href="#multiply-imputed-data"></a>
</h3>
<p>Multiple imputation is a popular strategy to deal with missing data,
and <em>adrftools</em> can accept models fit to multiply imputed data to
compute the ADRF. <code><a href="../reference/adrf.html">adrf()</a></code> computes the ADRF in each imputed
dataset and pools the results, yielding a single object similar to one
had <code><a href="../reference/adrf.html">adrf()</a></code> been called on a single model. Rubin’s rules are
used to pool the ADRF estimates and covariance matrix.</p>
<p><em>adrftools</em> requires <code>mira</code> objects from
<em>mice</em> (including <code>mimira</code> objects from
<em>MatchThem</em>); other forms of model fit to imputed data need to be
converted to this form, e.g., using <code><a href="https://amices.org/mice/reference/as.mira.html" class="external-link">mice::as.mira()</a></code>. Below,
we’ll demonstrate using multiply imputed data generated by <em>mice</em>
with <em>adrftools</em>. First, we’ll generate some missing data
artificially using <code><a href="https://amices.org/mice/reference/ampute.html" class="external-link">mice::ampute()</a></code>.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice" class="external-link">mice</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nhanes3lead_mis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/ampute.html" class="external-link">ampute</a></span><span class="op">(</span><span class="va">nhanes3lead</span>, mech <span class="op">=</span> <span class="st">"MCAR"</span><span class="op">)</span><span class="op">$</span><span class="va">amp</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nhanes3lead_mis</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Age              Male              Race          PIR       </span></span>
<span><span class="co">#&gt;  Min.   : 5.833   Min.   :0.0000   Black   :806   Min.   :0.000  </span></span>
<span><span class="co">#&gt;  1st Qu.: 7.500   1st Qu.:0.0000   Hispanic:843   1st Qu.:0.671  </span></span>
<span><span class="co">#&gt;  Median : 9.083   Median :1.0000   Other   :108   Median :1.287  </span></span>
<span><span class="co">#&gt;  Mean   : 9.017   Mean   :0.5078   White   :684   Mean   :1.627  </span></span>
<span><span class="co">#&gt;  3rd Qu.:10.500   3rd Qu.:1.0000   NA's    : 80   3rd Qu.:2.375  </span></span>
<span><span class="co">#&gt;  Max.   :11.917   Max.   :1.0000                  Max.   :6.943  </span></span>
<span><span class="co">#&gt;  NA's   :88       NA's   :89                      NA's   :79     </span></span>
<span><span class="co">#&gt;   Enough_Food     Smoke_in_Home    Smoke_Pregnant        NICU       </span></span>
<span><span class="co">#&gt;  Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.:1.0000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Median :1.0000   Median :0.0000   Median :0.0000   Median :0.0000  </span></span>
<span><span class="co">#&gt;  Mean   :0.8887   Mean   :0.3899   Mean   :0.1995   Mean   :0.1121  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Max.   :1.0000   Max.   :1.0000   Max.   :1.0000   Max.   :1.0000  </span></span>
<span><span class="co">#&gt;  NA's   :86       NA's   :77       NA's   :80       NA's   :85      </span></span>
<span><span class="co">#&gt;      logBLL             Math           Reading           Block       </span></span>
<span><span class="co">#&gt;  Min.   :-0.3567   Min.   : 0.000   Min.   : 0.000   Min.   : 1.000  </span></span>
<span><span class="co">#&gt;  1st Qu.: 0.4700   1st Qu.: 6.000   1st Qu.: 4.000   1st Qu.: 7.000  </span></span>
<span><span class="co">#&gt;  Median : 0.9933   Median : 8.000   Median : 7.000   Median : 9.000  </span></span>
<span><span class="co">#&gt;  Mean   : 0.9730   Mean   : 7.947   Mean   : 6.977   Mean   : 8.666  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 1.4586   3rd Qu.:10.000   3rd Qu.:10.000   3rd Qu.:11.000  </span></span>
<span><span class="co">#&gt;  Max.   : 3.3810   Max.   :20.000   Max.   :18.000   Max.   :19.000  </span></span>
<span><span class="co">#&gt;  NA's   :86        NA's   :97       NA's   :90       NA's   :84      </span></span>
<span><span class="co">#&gt;      Digit            MEC_wt          Block_bin     </span></span>
<span><span class="co">#&gt;  Min.   : 1.000   Min.   :  213.4   Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.: 6.000   1st Qu.: 1660.2   1st Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Median : 8.000   Median : 3117.1   Median :0.0000  </span></span>
<span><span class="co">#&gt;  Mean   : 8.192   Mean   : 7190.2   Mean   :0.1861  </span></span>
<span><span class="co">#&gt;  3rd Qu.:10.000   3rd Qu.: 9090.0   3rd Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Max.   :19.000   Max.   :70105.7   Max.   :1.0000  </span></span>
<span><span class="co">#&gt;  NA's   :78       NA's   :81        NA's   :76</span></span></code></pre></div>
<p>Next, we’ll use <code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice::mice()</a></code> to impute the missing data
into 5 imputed datasets. Note that in practice, many more imputations
should be used and the usual methods for assessing convergence and
imputation quality should be implemented; we skip those here.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">nhanes3lead_mis</span>, m <span class="op">=</span> <span class="fl">5</span>, print <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Next, we can fit an outcome model using <code><a href="https://rdrr.io/r/base/with.html" class="external-link">with()</a></code> to create
a <code>mira</code> object containing a list of the model fits.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">imp</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Math</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">logBLL</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span></span>
<span>                    <span class="op">(</span><span class="va">Age</span> <span class="op">+</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span> <span class="va">Smoke_in_Home</span> <span class="op">+</span></span>
<span>                       <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can supply the <code>mira</code> object to <code><a href="../reference/adrf.html">adrf()</a></code>,
which automatically estimates the ADRF in each imputed dataset and pools
the results.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adrf_mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">fit_mi</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_mi</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-64-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<p>The only option not supported with multiply imputed data is
bootstrapping. Setting <code>vcov = "boot"</code> or
<code>vcov = "fwb"</code> in <code><a href="../reference/adrf.html">adrf()</a></code> will yield an
error.</p>
<div class="section level4">
<h4 id="using-matchthem">Using <em>MatchThem</em><a class="anchor" aria-label="anchor" href="#using-matchthem"></a>
</h4>
<p>To estimate balancing weights in multiply imputed data, we can use
<code><a href="https://rdrr.io/pkg/MatchThem/man/weightthem.html" class="external-link">MatchThem::weightthem()</a></code>. All analyses work similarly to
when using <em>mice</em> alone.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/FarhadPishgar/MatchThem" class="external-link">MatchThem</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">w_mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MatchThem/man/weightthem.html" class="external-link">weightthem</a></span><span class="op">(</span><span class="va">logBLL</span> <span class="op">~</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span></span>
<span>                    <span class="va">Smoke_in_Home</span> <span class="op">+</span> <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span>,</span>
<span>                  datasets <span class="op">=</span> <span class="va">imp</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">"glm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_w_mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">w_mi</span>,</span>
<span>                 <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/glm_weightit.html" class="external-link">glm_weightit</a></span><span class="op">(</span><span class="va">Math</span> <span class="op">~</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">logBLL</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span></span>
<span>                                <span class="op">(</span><span class="va">Age</span> <span class="op">+</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span> <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span> <span class="va">Smoke_in_Home</span> <span class="op">+</span></span>
<span>                                   <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adrf_w_mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">fit_w_mi</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_w_mi</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-65-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="bayesian-models">Bayesian models<a class="anchor" aria-label="anchor" href="#bayesian-models"></a>
</h3>
<p>All of the described functionality works similarly for Bayesian
models (e.g., those fit with <code>brms::brm()</code>,
<code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">dbarts::bart2()</a></code>, or <code>rstanarm::stan_glm()</code>) as
it does for frequentist models. <em>adrftools</em> is a primarily
frequentist ecosystem, but special procedures exist for Bayesian models
as well. After fitting a Bayesian outcome model, it can be supplied to
<code><a href="../reference/adrf.html">adrf()</a></code> as usual to compute the ADRF. Unlike with
frequentist models, the ADRF posterior is also computed and forms the
basis for inference on the ADRF. All reported estimates are expected
<em>a posteriori</em> (EAP) estimates.</p>
<p>When calling <code><a href="../reference/adrf.html">adrf()</a></code> on a Bayesian model,
<code>vcov</code> can be set either to <code>"none"</code> to omit the
posterior and just use the EAP estimates or to <code>"posterior"</code>
to retain the posterior for inference. Leaving <code>vcov</code>
unspecified uses <code>"posterior"</code>. Below, we fit a Bayesian
additive regression tree (BART) model using <em>dbarts</em>.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vdorie/dbarts" class="external-link">dbarts</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">bfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">bart2</a></span><span class="op">(</span><span class="va">Math</span> <span class="op">~</span> <span class="va">logBLL</span> <span class="op">+</span> <span class="va">Male</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Race</span> <span class="op">+</span></span>
<span>                <span class="va">PIR</span> <span class="op">+</span> <span class="va">Enough_Food</span> <span class="op">+</span> <span class="va">Smoke_in_Home</span> <span class="op">+</span></span>
<span>                 <span class="va">Smoke_Pregnant</span> <span class="op">+</span> <span class="va">NICU</span>,</span>
<span>            data <span class="op">=</span> <span class="va">nhanes3lead</span>,</span>
<span>            keepTrees <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">#needed for adrf()</span></span>
<span>            verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adrf_bll_bayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adrf.html">adrf</a></span><span class="op">(</span><span class="va">bfit</span>, treat <span class="op">=</span> <span class="st">"logBLL"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adrf_bll_bayes</span></span>
<span><span class="co">#&gt; An <span style="font-style: italic;">effect_curve</span> object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  - curve type: ADRF</span></span>
<span><span class="co">#&gt;  - response: Math</span></span>
<span><span class="co">#&gt;  - treatment: logBLL</span></span>
<span><span class="co">#&gt;    + range: -0.3567 to 2.4248</span></span>
<span><span class="co">#&gt;  - inference: posterior</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Use `plot()` (`?adrftools::plot.effect_curve()`) to plot</span> <span style="font-style: italic;">the curve, `summary()`</span> <span style="font-style: italic;">(`?adrftools::summary.effect_curve()`) to test the curve,</span> <span style="font-style: italic;">or `{object}(values)` (`?adrftools::effect_curve-class()`)</span> <span style="font-style: italic;">to compute estimates.</span></span></span></code></pre></div>
<p>All credible intervals and bands use the confidence interval
interface (e.g., using <code>conf_level</code> in <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>
and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to request the credibility level). The posterior
can be treated as a multivariate normal distribution to compute
Wald-based credible intervals by setting <code>ci.type = "wald"</code>,
though the default is to use equi-tailed percentile intervals with
<code>ci.type = "perc"</code>. Simultaneous inference for equi-tailed
percentile intervals, if requested, uses the Bayesian algorithm
described by <span class="citation">Montiel Olea and Plagborg-Møller (<a href="#ref-montielolea2019">2019</a>)</span>, which guarantees uniform
credibility across the whole effect curve. P-values for estimates along
the effect curve are computed as the complement of the smallest
credibility level that excludes the null value.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adrf_bll_bayes</span><span class="op">)</span></span></code></pre></div>
<p><img src="adrftools_files/figure-html/unnamed-chunk-67-1.png" class="r-plt" width="528" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">adrf_bll_bayes</span><span class="op">(</span>logBLL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         ADRF Estimates</span></span>
<span><span class="co">#&gt; ───────────────────────────────</span></span>
<span><span class="co">#&gt;  logBLL Estimate CI Low CI High</span></span>
<span><span class="co">#&gt;       0    8.466  8.006   9.261</span></span>
<span><span class="co">#&gt;       1    7.971  7.591   8.360</span></span>
<span><span class="co">#&gt;       2    7.125  6.572   7.785</span></span>
<span><span class="co">#&gt; ───────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Inference: posterior, simultaneous</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Confidence level: 95%</span></span></span></code></pre></div>
<p>Omnibus tests for the shape of the line (i.e., by using
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on an <code>effect_curve</code> object) are
strictly frequentist and use a shifted version of the posterior as if it
were the sampling distribution of the effect curve under the null
hypothesis.</p>
<p>When Bayesian models are fit to multiply imputed data, the draws of
the ADRF estimates across imputed datasets are pooled to form a single
posterior as described by <span class="citation">Zhou and Reiter (<a href="#ref-zhouNoteBayesianInference2010">2010</a>)</span>.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-hansenVarianceEstimationAverage2024" class="csl-entry">
Hansen, Stefan Nygaard, and Morten Overgaard. 2024. <span>“Variance
Estimation for Average Treatment Effects Estimated by
g-Computation.”</span> <em>Metrika</em>, April. <a href="https://doi.org/10.1007/s00184-024-00962-4" class="external-link">https://doi.org/10.1007/s00184-024-00962-4</a>.
</div>
<div id="ref-hillBayesianNonparametricModeling2011" class="csl-entry">
Hill, Jennifer L. 2011. <span>“Bayesian Nonparametric Modeling for
Causal Inference.”</span> <em>Journal of Computational and Graphical
Statistics</em> 20 (1): 217–40. <a href="https://doi.org/10.1198/jcgs.2010.08162" class="external-link">https://doi.org/10.1198/jcgs.2010.08162</a>.
</div>
<div id="ref-montielolea2019" class="csl-entry">
Montiel Olea, José Luis, and Mikkel Plagborg-Møller. 2019.
<span>“Simultaneous Confidence Bands: Theory, Implementation, and an
Application to SVARs.”</span> <em>Journal of Applied Econometrics</em>
34 (1): 1–17. <a href="https://doi.org/10.1002/jae.2656" class="external-link">https://doi.org/10.1002/jae.2656</a>.
</div>
<div id="ref-neugebauerNonparametricCausalEffects2007" class="csl-entry">
Neugebauer, Romain, and Mark van der Laan. 2007. <span>“Nonparametric
Causal Effects Based on Marginal Structural Models.”</span> <em>Journal
of Statistical Planning and Inference</em> 137 (2): 419–34. <a href="https://doi.org/10.1016/j.jspi.2005.12.008" class="external-link">https://doi.org/10.1016/j.jspi.2005.12.008</a>.
</div>
<div id="ref-xu2020" class="csl-entry">
Xu, Li, Chris Gotwalt, Yili Hong, Caleb B. King, and William Q. Meeker.
2020. <span>“Applications of the Fractional-Random-Weight
Bootstrap.”</span> <em>The American Statistician</em> 74 (4): 345–58. <a href="https://doi.org/10.1080/00031305.2020.1731599" class="external-link">https://doi.org/10.1080/00031305.2020.1731599</a>.
</div>
<div id="ref-zhangCausalInferenceQuantitative2016" class="csl-entry">
Zhang, Zhiwei, Jie Zhou, Weihua Cao, and Jun Zhang. 2016. <span>“Causal
Inference with a Quantitative Exposure.”</span> <em>Statistical Methods
in Medical Research</em> 25 (1): 315–35. <a href="https://doi.org/10.1177/0962280212452333" class="external-link">https://doi.org/10.1177/0962280212452333</a>.
</div>
<div id="ref-zhouNoteBayesianInference2010" class="csl-entry">
Zhou, Xiang, and Jerome P. Reiter. 2010. <span>“A Note on Bayesian
Inference After Multiple Imputation.”</span> <em>The American
Statistician</em> 64 (2): 159–63. <a href="https://doi.org/10.1198/tast.2010.09109" class="external-link">https://doi.org/10.1198/tast.2010.09109</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
